# hydro_trader
Hydro Trader is a framework for trading hydropower in a competitive setting.  
It consists of two parts, a server api that host a game and a client that can access and play the game.
The client should be extended by the player to perform better.

The game is played between N players, each competing in the same market, with the goal to have
as much money at the end of the time T.
The weather and market is simulated to be based in Norway.


# Game 
The player controls a network of hydro reservoirs. Each the player must:
1. Decide which reservoirs should produce electricity.
2. If producing electricity, what price do I demand for my power.

# The Environment
The player receive the following info about the environment each timestep, the data is current (time = t):
Per reservoir:
    - Water Amount
    - Water Height (height of the reservoir : assume circular reservoirs)
    - Inflow (from rivers + weather + snow melting)
    - Outflow (can be positive if not producing due to overflow)
    - TODO: add any other simple yet relevant factors here

Per River (that connects the reservoirs):
    - Water Flow
    - Inflow (Includes the inflow from the mountains and weather)

Weather:
    - Probability of rain for the next 3 time steps (forecast)
    - Current precipitation amount
    - Temperature

Mountains:
    - A series of 5 measuring points for snow amounts in the mountains (that will melt at some point and flow downstream)

# Market
The player will get a market ask (how much MWh the market wants to buy in t+1)

# Actions
With the status in time=t, including the ask, the player must decide if he wants to produce or not.

# Receives
The player receives how much energy he produces, how much he sold, and what price he got from it.
In addition, he can receive penalties (in cash) that he needs to pay if he exceeds minimum/maximum water 
in the rivers or reservoirs.
He also gets a list of: 1. what other players sold, 2. How much cash each player has, 3. How much water each player has (in total).
The player also get the status of the next step.


# The Server 
Each player connects with a WebSocket to the server. When the server gets the signal to start the game, the server runs until it is finished (T=1000).

Flow of game:

[Client Gets Info -> Decides to produce] -> [Client Gets Info -> Decides to Produce] ... 
Brackets mark a timestep. 

## Implementation Details
The server is implemented in Python using FastAPI and asyncio for efficient asynchronous processing of player connections and game state updates. All players run in the same simulated environment, ensuring fair competition.

## Market Data
Market demands are read from an external file generated by a separate process to ensure realistic market conditions based on historical data patterns.

